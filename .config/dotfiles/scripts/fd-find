#!/usr/bin/env bash
# Author: Alalilacias
# Description: Installs fd (modern find) via cargo into .local/tools and symlinks
# Syntax: source "$HOME/.dotfiles/.config/dotfiles/scripts/fd"
# Version: 0.3

set -euo pipefail

CARGO_HOME="$HOME/.dotfiles/.local/tools/rust/.cargo"
BIN_DIR="$HOME/.dotfiles/bin"
FD_BIN="$CARGO_HOME/bin/fd"

if [[ ! -x "$CARGO_HOME/bin/cargo" ]]; then
  log_error "Rust is required but not found at $CARGO_HOME/bin/cargo."
  return 1
fi

if [[ -x "$FD_BIN" ]]; then
  log_notice "fd is already installed at $FD_BIN"
  return 0
fi

log_info "Installing fd-find using cargo..."
"$CARGO_HOME/bin/cargo" install --locked fd-find

mkdir -p "$BIN_DIR"
ln -sf "$FD_BIN" "$BIN_DIR/fd"

log_info "fd installed successfully and linked to $BIN_DIR/fd"
