#!/usr/bin/env bash
# Author: Alalilacias
# Description: Installs tree-sitter CLI locally and symlinks binary
# Syntax: source "$HOME/.dotfiles/.config/dotfiles/scripts/tree-sitter"
# Version: 0.5

set -euo pipefail

BIN_DIR="$HOME/.dotfiles/bin"
NPM_PREFIX="$HOME/.dotfiles/.local/tools/tree-sitter-npm"
TREE_SITTER_BIN="$NPM_PREFIX/bin/tree-sitter"

if ! command -v npm &>/dev/null; then
  log_error "npm is not installed or not on path. Cannot install tree-sitter" >$2
  return 1
fi

mkdir -p "$BIN_DIR" "$NPM_PREFIX"

(
  cd "$HOME"
  npm install -g tree-sitter-cli --prefix "$NPM_PREFIX"
)

ln -sf "$TREE_SITTER_BIN" "$BIN_DIR/tree-sitter"

log_info "tree-sitter installed successfully to $BIN_DIR/tree-sitter"
