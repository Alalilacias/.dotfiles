#!/usr/bin/env bash
#
# Author: Alalilacias
# Description: Creates custom functions in .zshrc when invoked.
# Syntax: source pfunctions
# Version: 0.3

# Makes all cd calls use the ll alias to lists files below the directory we moved to the way I like it.
cdl() {
  cd "$@" && ll
}

# Allows to create a directory and change to it. Have never used it.
mkcd() {
  mkdir -p "$1" && cdl "$1"
}

check_git() {
  SEARCH_DIR=~                             # Change to wherever your projects live
  EXCLUDES="proc sys dev run var/lib/snap" # Add more if needed

  find "$SEARCH_DIR" -type d -name ".git" 2>/dev/null | while read gitdir; do
    repo_dir="$(dirname "$gitdir")"

    # Skip excluded dirs
    for excl in $EXCLUDES; do
      [[ "$repo_dir" == /$excl* ]] && continue 2
    done

    # Check it's a real Git repo
    if git -C "$repo_dir" rev-parse --is-inside-work-tree &>/dev/null; then
      echo "Checking $repo_dir"
      cd "$repo_dir" || continue

      git_status=$(git status --porcelain)
      ahead=$(git status -sb 2>/dev/null | grep -o '\[ahead [0-9]*\]' || true)

      if [[ -n "$git_status" || -n "$ahead" ]]; then
        echo "  --> Changes detected:"
        [[ -n "$git_status" ]] && echo "$git_status" | sed 's/^/     /'
        [[ -n "$ahead" ]] && echo "     Unpushed commits: $ahead"
      fi
    fi
  done
}

# Measure the startup time of the shell (default: $SHELL) by running it 10 times.
# Uses '/usr/bin/time' to track execution time.
# The shell starts in interactive mode (-i) but only executes 'exit' (-c exit).
timezsh() {
  local shell=${1:-$SHELL}                    # Use the provided shell or default to $SHELL
  repeat 10 /usr/bin/time "$shell" -i -c exit # Run the timing test 10 times
}
